
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Pi Payment Demo</title>
  <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
  <h1>Pi Payment Demo - No Server Mode</h1>
  <button id="signInButton">Sign in with Pi</button>
  <button id="payButton" disabled>Test Payment</button>

  <script>
    Pi.init({ version: "2.0", sandbox: true });

    const signInButton = document.getElementById('signInButton');
    const payButton = document.getElementById('payButton');
    let currentUser = null;

    signInButton.addEventListener('click', async () => {
      try {
        const scopes = ['username', 'payments'];
        currentUser = await Pi.authenticate(scopes, onIncompletePaymentFound);
        alert(`Signed in as ${currentUser.user.username}`);
        payButton.disabled = false;
      } catch (err) {
        console.error(err);
      }
    });

    payButton.addEventListener('click', async () => {
      try {
        const payment = await Pi.createPayment({
          amount: 1,
          memo: "Test Payment",
          metadata: { orderId: 1234 }
        }, {
          onReadyForServerApproval: paymentId => {
            alert(`Payment ready for approval: ${paymentId}`);
          },
          onReadyForServerCompletion: paymentId => {
            alert(`Payment ready for completion: ${paymentId}`);
          },
          onCancel: paymentId => {
            alert(`Payment cancelled: ${paymentId}`);
          },
          onError: (error, payment) => {
            console.error(error);
            alert("Payment error: " + error);
          }
        });
        console.log(payment);
      } catch (err) {
        console.error(err);
      }
    });

    function onIncompletePaymentFound(payment) {
      console.log("Incomplete payment found:", payment);
    }
  </script>
</body>
</html>
