<!doctype html>
<html lang="en">
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pi Browser Diagnostics</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:20px;line-height:1.45}
  code{background:#f6f8fa;padding:2px 6px;border-radius:6px}
  pre{white-space:pre-wrap;background:#f6f8fa;padding:12px;border-radius:10px}
  button{padding:10px 14px;margin:6px 8px 6px 0;border:1px solid #bbb;border-radius:10px;background:#fafafa;cursor:pointer}
</style>
<h1>Pi Browser Diagnostics</h1>

<p><b>User-Agent:</b> <code id="ua"></code></p>
<p><b>Detected Pi Browser:</b> <span id="isPi">…</span></p>
<p><b>window.Pi present:</b> <span id="hasPi">…</span></p>
<p><b>Pi properties:</b></p>
<pre id="piDump">(loading)</pre>

<div>
  <button id="openPi">Open this page via pi:// deep link</button>
  <button id="testInit">Test Pi.init (sandbox)</button>
  <button id="testAuth">Test Pi.authenticate(['username'])</button>
</div>

<pre id="log"></pre>

<script>
const logBox = document.getElementById('log');
const log = (...a)=>{ logBox.textContent += a.map(x=>typeof x==='object'?JSON.stringify(x):String(x)).join(' ') + '\n'; };

const ua = (navigator.userAgent||'');
document.getElementById('ua').textContent = ua;

function isProbablyPiBrowser(){
  const s = ua.toLowerCase();
  return s.includes('pibrowser') || !!window.ReactNativeWebView || (window.Pi && typeof Pi.openShareDialog === 'function');
}
document.getElementById('isPi').textContent = isProbablyPiBrowser() ? 'YES' : 'NO';

document.getElementById('hasPi').textContent = !!window.Pi ? 'YES' : 'NO';

(function dumpPi(){
  try{
    const d = {
      typeofPi: typeof window.Pi,
      keys: window.Pi ? Object.keys(window.Pi) : null,
      hasAuthenticate: !!(window.Pi && window.Pi.authenticate),
      hasInit: !!(window.Pi && window.Pi.init),
      hasCreatePayment: !!(window.Pi && window.Pi.createPayment)
    };
    document.getElementById('piDump').textContent = JSON.stringify(d,null,2);
  }catch(e){
    document.getElementById('piDump').textContent = 'Error dumping Pi: '+e;
  }
})();

document.getElementById('openPi').onclick = ()=>{
  const target = (location.href||'').replace(/^https?:\/\//,'');
  location.href = 'pi://' + target;
};

document.getElementById('testInit').onclick = ()=>{
  try {
    if (!window.Pi) { log('Pi not present'); alert('Pi not present'); return; }
    Pi.init({version:'2.0', sandbox:true});
    log('Pi.init OK (sandbox=true)');
    alert('Pi.init OK (sandbox=true)');
  } catch(e){
    log('Pi.init error:', e);
    alert('Pi.init error: ' + (e && e.message ? e.message : e));
  }
};

document.getElementById('testAuth').onclick = async ()=>{
  try {
    if (!window.Pi) { log('Pi not present'); alert('Pi not present'); return; }
    Pi.init({version:'2.0', sandbox:true});
    const res = await Pi.authenticate(['username']);
    log('Auth OK as', res && res.user && res.user.username);
    alert('Auth OK as ' + (res && res.user && res.user.username));
  } catch(e){
    log('Auth error:', e);
    alert('Auth error: ' + (e && e.message ? e.message : e));
  }
};
</script>
